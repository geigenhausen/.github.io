<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="description" content="Explore worldwide travel photography featuring beautiful locations from Japan, France, and more" />
    <meta name="theme-color" content="#a8d8ff" />
    <title>Leo Foissac | Travel & Worldwide Photography</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;800&display=swap" rel="stylesheet" />

    <!-- Styles -->
    <link rel="stylesheet" href="style.css" />
    <link rel="preload" as="image" href="wallpapers/tokyo_street_night_by_arsenixc_dbbpqj5.jpeg">
    
    <!-- Lightbox CSS -->
    <link href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" rel="stylesheet" />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link rel="apple-touch-icon" href="apple-touch-icon.png" />
</head>
<body>
    <div id="background-image" style="background-color: #1a1a1a;"></div>
    
    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
        <span class="icon-light">‚òÄÔ∏è</span>
        <span class="icon-dark">üåô</span>
    </button>

    <div class="page-wrapper">
        <header class="site-header">
            <div class="header-content">
                <div class="header-text">
                    <h1 class="site-title">
                        <span class="title-main">Leo Foissac</span>
                        <span class="title-sub">Fujifilm x100VI üì∑</span>
                    </h1>
                    <p class="site-description">üá´üá∑ living in üáØüáµ showcasing worldwide pictures.</p>
                </div>
            </div>
        </header>

        <main class="site-main">
            <!-- Add copyright modal -->
            <div id="modal" class="copyright-modal">
                <div class="modal-content">
                    <p>¬© 2025 Leo Foissac. All rights reserved.</p>
                </div>
            </div>

            <div class="countries-grid">
                <!-- Japan Section -->
                <section class="country-card" data-country="japan">
                    <details open>
                        <summary class="country-header">
                            <span class="country-flag">üáØüáµ</span>
                            <span class="country-name">Japan„ÉªÊó•Êú¨</span>
                        </summary>
                        <div class="gallery-preview">
                            <div class="gallery">
                                <article class="gallery-item" data-region="Tokyo">
                                    <div class="gallery-image-wrapper">
                                        <img src="images/tokyo/DSCF0601.jpg" alt="Tokyo" loading="lazy" />
                                    </div>
                                    <div class="gallery-item-info">
                                        <h3>Tokyo„ÉªÊù±‰∫¨</h3>
                                        <p>Capital of the Far East</p>
                                    </div>
                                </article>
                                <article class="gallery-item" data-region="Ehime">
                                    <div class="gallery-image-wrapper">
                                        <img src="images/ehime/DSCF1734.jpg" alt="Matsuyama" loading="lazy"/>
                                    </div>
                                    <div class="gallery-item-info">
                                        <h3>Ehime„ÉªÊÑõÂ™õ</h3>
                                        <p>Heart of Shikoku</p>
                                    </div>
                                </article>
                                <article class="gallery-item" data-region="Other">
                                    <div class="gallery-image-wrapper">
                                        <img src="images/sakura/DSCF0118.jpg" alt="Cherry Blossoms in Full Bloom" loading="lazy" />
                                    </div>
                                    <div class="gallery-item-info">
                                        <h3>Cherry Blossom„ÉªÊ°ú</h3>
                                        <p>Spring beauty across Japan</p>
                                    </div>
                                </article>
                            </div>
                        </div>
                    </details>
                </section>

                <!-- France Section -->
                <section class="country-card temporarily-hidden" data-country="france">
                    <details>
                        <summary class="country-header">
                            <span class="country-flag">üá´üá∑</span>
                            <span class="country-name">France„Éª„Éï„É©„É≥„Çπ</span>
                        </summary>
                        <div class="gallery-preview">
                            <div class="gallery">
                                <article class="gallery-item" data-region="Paris">
                                    <div class="gallery-image-wrapper">
                                        <img src="images/france/paris.jpg" alt="Eiffel Tower at Sunset" loading="lazy" />
                                    </div>
                                    <div class="gallery-item-info">
                                        <h3>Paris</h3>
                                        <p>City of Light and Romance</p>
                                    </div>
                                </article>
                                <article class="gallery-item" data-region="Sud-ouest">
                                    <div class="gallery-image-wrapper">
                                        <img src="images/france/cahors.jpg" alt="History and Cuisine" loading="lazy" />
                                    </div>
                                    <div class="gallery-item-info">
                                        <h3>Cahors</h3>
                                        <p>Gourmet and history</p>
                                    </div>
                                </article>
                            </div>
                        </div>
                    </details>
                </section>
            </div>

            <!-- Sub-galleries -->
            <div class="sub-gallery" data-region="Tokyo">
                <div class="sub-gallery-header">
                    <h2>Tokyo (Êù±‰∫¨)</h2>
                    <button class="sub-gallery-close">√ó</button>
                </div>
                <div class="sub-gallery-grid">
                    <article class="sub-gallery-item">
                        <a href="images/tokyo/DSCF0601.jpg" class="glightbox" data-gallery="tokyo-full">
                            <div class="gallery-image-wrapper">
                                <img src="images/tokyo/DSCF0601.jpg" alt="Tokyo Scene 1" loading="lazy" />
                            </div>
                            <div class="gallery-item-info">
                                <h3>Sky Tree</h3>
                                <p>Ê±üÊù±Âå∫, Mar. 2025</p>
                            </div>
                        </a>
                    </article>
                    <article class="sub-gallery-item">
                        <a href="images/tokyo/DSCF0102.jpg" class="glightbox" data-gallery="tokyo-full">
                            <div class="gallery-image-wrapper">
                                <img src="images/tokyo/DSCF0102.jpg" alt="Tokyo Scene 1" loading="lazy" />
                            </div>
                            <div class="gallery-item-info">
                                <h3>Kagurazaka</h3>
                                <p>Êñ∞ÂÆøÂå∫, Mar. 2025</p>
                            </div>
                        </a>
                    </article>
                </div>
            </div>

            <div class="sub-gallery" data-region="Ehime">
                <div class="sub-gallery-header">
                    <h2>Ehime (ÊÑõÂ™õ)</h2>
                    <button class="sub-gallery-close">√ó</button>
                </div>
                <div class="sub-gallery-grid">
                    <article class="sub-gallery-item">
                        <a href="images/ehime/DSCF1615.jpg" class="glightbox" data-gallery="ehime-full">
                            <div class="gallery-image-wrapper">
                                <img src="images/ehime/DSCF1615.jpg" alt="Matsuyama Castle" loading="lazy" />
                            </div>
                            <div class="gallery-item-info">
                                <h3>Matsuyama Castle n.1</h3>
                                <p>ÊùæÂ±±, Apr. 2025</p>
                            </div>
                        </a>
                    </article>
                    <article class="sub-gallery-item">
                        <a href="images/ehime/DSCF1711.jpg" class="glightbox" data-gallery="ehime-full">
                            <div class="gallery-image-wrapper">
                                <img src="images/ehime/DSCF1711.jpg" alt="Matsuyama Gulf" loading="lazy" />
                            </div>
                            <div class="gallery-item-info">
                                <h3>Matsuyama outskirts</h3>
                                <p>ÊùæÂ±±, Apr. 2025</p>
                            </div>
                        </a>
                    </article>
                    <article class="sub-gallery-item">
                        <a href="images/ehime/DSCF1734.jpg" class="glightbox" data-gallery="ehime-full">
                            <div class="gallery-image-wrapper">
                                <img src="images/ehime/DSCF1734.jpg" alt="Mountain Castle" loading="lazy" />
                            </div>
                            <div class="gallery-item-info">
                                <h3>Matsuyama Castle n.2</h3>
                                <p>ÊùæÂ±±, Apr. 2025</p>
                            </div>
                        </a>
                    </article>
                    <article class="sub-gallery-item">
                        <a href="images/ehime/DSCF1710.jpg" class="glightbox" data-gallery="ehime-full">
                            <div class="gallery-image-wrapper">
                                <img src="images/ehime/DSCF1710.jpg" alt="European castle" loading="lazy" />
                            </div>
                            <div class="gallery-item-info">
                                <h3>Western-style Castle</h3>
                                <p>ÊùæÂ±±, Apr. 2025</p>
                            </div>
                        </a>
                    </article>
                </div>
            </div>
            
            <div class="sub-gallery" data-region="Other">
                <div class="sub-gallery-header">
                    <h2>Cherry Blossom</h2>
                    <button class="sub-gallery-close">√ó</button>
                </div>
                <div class="sub-gallery-grid">
                    <article class="sub-gallery-item">
                        <div class="gallery-image-wrapper">
                            <a href="images/sakura/DSCF0118.jpg" class="glightbox" data-gallery="sakura-full">
                                <img src="images/sakura/DSCF0118.jpg" alt="Cherry Blossom" loading="lazy" />
                            </a>
                        </div>
                        <div class="gallery-item-info">
                            <h3>Early Sakura</h3>
                            <p>Êñá‰∫¨Âå∫, Mar. 2025</p>
                        </div>
                    </article>
                    <article class="sub-gallery-item">
                        <div class="gallery-image-wrapper">
                            <a href="images/sakura/DSCF1218.jpg" class="glightbox" data-gallery="sakura-full">
                                <img src="images/sakura/DSCF1218.jpg" alt="yozakura" loading="lazy" />
                            </a>
                        </div>
                        <div class="gallery-item-info">
                            <h3>Yozakura„ÉªÂ§úÊ°ú</h3>
                            <p>‰∏≠ÁõÆÈªí, Mar. 2025</p>
                        </div>
                    </article>
                    <article class="sub-gallery-item">
                        <div class="gallery-image-wrapper">
                            <a href="images/sakura/DSCF1010.jpg" class="glightbox" data-gallery="sakura-full">
                                <img src="images/sakura/DSCF1010.jpg" alt="yoshino" loading="lazy" />
                            </a>
                        </div>
                        <div class="gallery-item-info">
                            <h3>Somei Yoshino n.1</h3>
                            <p>Êñá‰∫¨Âå∫, Mar. 2025</p>
                        </div>
                    </article>
                    <article class="sub-gallery-item">
                        <div class="gallery-image-wrapper">
                            <a href="images/sakura/DSCF1111.jpg" class="glightbox" data-gallery="sakura-full">
                                <img src="images/sakura/DSCF1111.jpg" alt="sakura-river" loading="lazy" />
                            </a>
                        </div>
                        <div class="gallery-item-info">
                            <h3>Edogawabashi hanami</h3>
                            <p>Êñá‰∫¨Âå∫, Mar. 2025</p>
                        </div>
                    </article>
                </div>
            </div>
        </main>

        <!-- Visitor Counter -->
        <div class="visitor-counter">
            <span>Total Visits: </span>
            <span id="visitor-count">Loading...</span>
        </div>

        <!-- Footer -->
        <footer class="site-footer">
         <div class="footer-content">
          <nav class="footer-nav">
            <div class="nav-links">
                <a href="/about">About me</a>
                <span class="nav-separator">|</span>
                <a href="/">Gallery</a>
                <span class="nav-separator">|</span>
                <a href="/shop">Shop</a>
             </div>
             <div class="copyright-text">
                ¬© 2025 Leo Foissac. All rights reserved.
            </div>
        </nav>
    </div>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
    
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDUs89M4HIHPMcC_b7HH-U73pCEgT29djg",
            authDomain: "pibrac-photos.firebaseapp.com",
            projectId: "pibrac-photos",
            storageBucket: "pibrac-photos.firebasestorage.app",
            messagingSenderId: "300295005274",
            appId: "1:300295005274:web:166d80b1d31df9aa93e463",
            databaseURL: "https://pibrac-photos-default-rtdb.europe-west1.firebasedatabase.app" // Added database URL
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize elements
            const galleryItems = document.querySelectorAll('.gallery-item');
            const themeToggle = document.getElementById('theme-toggle');
            const visitorCount = document.getElementById('visitor-count');
            const backgroundElement = document.getElementById('background-image');
            const modal = document.getElementById('modal');

            // Prevent image saving and context menu
            function preventImageSaving(e) {
                // Only prevent default if it's a long press
                if (e.type === 'contextmenu') {
                    e.preventDefault();
                    showCopyrightNotice();
                    return false;
                }
            }

            // Add protection for all images
            document.addEventListener('contextmenu', preventImageSaving);

            // Handle touch events
            let touchStartTime = 0;
            const LONG_PRESS_DURATION = 500; // 500ms for long press

            document.addEventListener('touchstart', function(e) {
                touchStartTime = Date.now();
            }, { passive: true });

            document.addEventListener('touchend', function(e) {
                const touchDuration = Date.now() - touchStartTime;
                if (touchDuration >= LONG_PRESS_DURATION && e.target.tagName === 'IMG') {
                    e.preventDefault();
                    showCopyrightNotice();
                }
            }, { passive: false });

            // Show copyright notice on save attempt
            function showCopyrightNotice() {
                if (modal) {
                    modal.classList.add('active');
                    setTimeout(() => modal.classList.remove('active'), 3000);
                }
            }

            // Additional protection for iOS devices
            document.addEventListener('touchstart', function(e) {
                if (e.touches.length > 1) {
                    e.preventDefault();
                    showCopyrightNotice();
                }
            }, { passive: false });

            document.addEventListener('gesturestart', function(e) {
                e.preventDefault();
                showCopyrightNotice();
            });

            // Initialize Lightbox with improved touch handling
            const lightbox = GLightbox({
                touchNavigation: true,
                loop: true,
                closeButton: true,
                zoomable: true,
                draggable: true,
                selector: '.glightbox',
                preload: false,
                height: 'auto',
                width: 'auto',
                slideEffect: 'fade',
                closeOnOutsideClick: true,
                descPosition: 'bottom',
                touchFollowAxis: true,
                keyboardNavigation: true,
                openEffect: 'zoom',
                closeEffect: 'fade',
                cssEfects: {
                    zoom: { in: 'zoomIn', out: 'zoomOut' },
                    fade: { in: 'fadeIn', out: 'fadeOut' }
                },
                onOpen: () => {
                    // Add protection to lightbox images while allowing interaction
                    const lightboxImages = document.querySelectorAll('.gslide img');
                    lightboxImages.forEach(img => {
                        img.style.pointerEvents = 'auto';
                        img.draggable = false;
                    });
                }
            });

            // Theme toggle functionality
            function setTheme(isDark) {
                document.body.classList.toggle('dark-mode', isDark);
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
            }

            // Initialize theme before loading background
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                setTheme(true);
            }

            // Theme toggle event listener
            themeToggle.addEventListener('click', () => {
                const isDark = !document.body.classList.contains('dark-mode');
                setTheme(isDark);
            });

            // Refresh lightbox when sub-gallery opens
            function openSubGallery(region) {
                const subGallery = document.querySelector(`.sub-gallery[data-region="${region}"]`);
                if (subGallery) {
                    subGallery.classList.add('active');
                    document.body.style.overflow = 'hidden';
                    // Refresh lightbox after sub-gallery is visible
                    setTimeout(() => {
                        lightbox.reload();
                    }, 100);
                }
            }

            function closeSubGallery() {
                const activeSubGallery = document.querySelector('.sub-gallery.active');
                if (activeSubGallery) {
                    activeSubGallery.classList.remove('active');
                    document.body.style.overflow = '';
                }
            }

            // Add click handlers to gallery items
            galleryItems.forEach(item => {
                const region = item.getAttribute('data-region');
                
                // Make both image and info clickable
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    openSubGallery(region);
                });
            });

            // Sub-gallery close handlers
            document.querySelectorAll('.sub-gallery-close').forEach(button => {
                button.addEventListener('click', closeSubGallery);
            });

            document.querySelectorAll('.sub-gallery').forEach(gallery => {
                gallery.addEventListener('click', function(e) {
                    // Only close if clicking the background, not the images or content
                    if (e.target === this) {
                        closeSubGallery();
                    }
                });

                // Prevent click propagation from gallery items
                gallery.querySelectorAll('.sub-gallery-item').forEach(item => {
                    item.addEventListener('click', function(e) {
                        e.stopPropagation();
                    });
                });
            });

            // ESC key handler
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeSubGallery();
                }
            });

            // Update visitor count
            function updateVisitorCount() {
                const visitsRef = database.ref('visits');
                
                // Get current count
                visitsRef.once('value').then((snapshot) => {
                    const currentCount = snapshot.val() || 0;
                    
                    // Check if this is a new session
                    const lastVisitTime = sessionStorage.getItem('lastVisitTime');
                    const currentTime = Date.now();
                    
                    if (!lastVisitTime || (currentTime - parseInt(lastVisitTime)) > 30 * 60 * 1000) { // 30 minutes session timeout
                        // Increment the count
                        visitsRef.set(currentCount + 1);
                        sessionStorage.setItem('lastVisitTime', currentTime);
                    }
                    
                    // Display the count
                    visitorCount.textContent = currentCount.toLocaleString();
                });

                // Listen for real-time updates
                visitsRef.on('value', (snapshot) => {
                    const count = snapshot.val() || 0;
                    visitorCount.textContent = count.toLocaleString();
                });
            }

            // Initialize visitor counter
            updateVisitorCount();

            // Background image
            const backgroundImage = new Image();
            
            backgroundImage.onload = function() {
                backgroundElement.style.backgroundImage = `url('${this.src}')`;
            };

            backgroundImage.onerror = function() {
                console.error('Failed to load background image');
                backgroundElement.style.backgroundColor = '#1a1a1a';
            };

            backgroundImage.src = 'wallpapers/tokyo_street_night_by_arsenixc_dbbpqj5.jpeg';

            // Prevent details from closing when clicking gallery items
            document.querySelectorAll('.gallery').forEach(gallery => {
                gallery.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            });
        });
    </script>
</body>
</html>
